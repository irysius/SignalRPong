@{
    ViewBag.Title = "Pong";
}

<h2>Pong</h2>
<input type="hidden" id="displayName" />
<input type="hidden" id="playerId" />
<input type="hidden" id="roomId" />
<input type="button" id="btn-join" value="Join Room" disabled/>
<input type="button" id="btn-leave" value="Leave Room" disabled/>
<input type="button" id="btn-start" value="Start Game" disabled/>
<div>

</div>
<div>
    <canvas id="main-canvas" style="float:left;"></canvas>
    <ul style="float:right;" id="messages">

    </ul>
</div>

@section scripts {
    @Scripts.Render("~/bundles/createjs")
    <script src="~/Scripts/jquery.signalR-1.1.3.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script src="~/Scripts/PongGame.js"></script>
    <script>
        $(function () {
            $('#displayName').val(prompt("please enter your username."));

            var pong = $.connection.PongHub;
            pongHub = pong;

            // Hook up all the server to client methods here.
            pong.client.updateMessage = function (message) {
                $('#messages').append('<li>' + message + '</li>');
            };
            pong.client.updatePositions = function (p1, p2, bx, by) {
                updatePositions(p1, p2, bx, by);
            };
            pong.client.updateScore = function (s1, s2) {
                alert('score updated');
                updateScore(s1, s2);
            };
            pong.client.onRoomRegistered = function (rid, pid) {
                $('#roomId').val(rid);
                $('#playerId').val(pid);
                roomId = $('#roomId').val();
                if (pid == 1) {
                    isPlayer1 = true;
                } else {
                    isPlayer1 = false;
                }
                $('#btn-join').prop('disabled', 'disabled');
                $('#btn-leave').prop('disabled', '');
            };
            pong.client.onGameStartable = function () {
                $('#btn-start').prop('disabled', '');
            };
            pong.client.onGameUnstartable = function () {
                $('#btn-start').prop('disabled', 'disabled');
            };
            pong.client.onGameStarted = function () {
                $('#btn-start').prop('disabled', 'disabled');
                startGame();
            };

            $.connection.hub.start().done(function () {
                initializeGame();

                $('#btn-join').prop('disabled', '');
                // Hook up all client to server actions here.
                
                $('#btn-join').on("click", function () {
                    pong.server.joinGame($('input#displayName').val());
                });
                $('#btn-leave').on("click", function () {
                    pong.server.leaveGame(roomId);
                    $('#btn-join').prop('disabled', '');
                    $('#btn-leave').prop('disabled', 'disabled');
                });
                $('#btn-start').on("click", function () {
                    pong.server.startGame(roomId);
                });
            });
        });
    </script>
}